<% provide(:title, 'Modifier un message') %>
<h1>Modifier un message</h1>
<span style="color:red;">Veillez à ne dévoilez aucune solution à un exercice ou un problème.</span><br/><br/>
<% if @message.user != current_user %>
<span style="color:red;">Ce message n'est pas le vôtre. Modifiez-le uniquement si cela est nécessaire (divulgation d'une réponse, vulgarité,...)</span><br/><br/>
<% end %>
<% if @chapter.nil? %>
    <%= form_for([@message.subject, @message]) do |f| %>
      <%= render 'form', f: f %>
      <br />
      <%= f.submit "Editer", class: "btn btn-large btn-primary" %>
    <% end %>
<% else %>
    <%= form_for([@chapter, @message.subject, @message]) do |f| %>
      <%= render 'form', f: f %>
      <br />
      <%= f.submit "Editer", class: "btn btn-large btn-primary" %>
    <% end %>
<% end %>

<br/>

<% tot = @message.subject.messages.where("id <= ?", @message.id).count %>
<% page = [0,((tot-1)/10).floor].max + 1 %>
      
<% if @chapter.nil? %>
<center><%= link_to "Retour au sujet", subject_path(@message.subject, :anchor => @message.id, :page => page) %></center>
<% else %>
<center><%= link_to "Retour au sujet", chapter_subject_path(@chapter, @message.subject, :anchor => @message.id, :page => page) %></center>
<% end %>

<script>
Preview.Init();
Preview.Update();
</script>
