<script src="/assets/previewsafe.js"></script>

<SCRIPT language="javascript">
var i = 1;
function add() {
 
    //Create an input type dynamically.
    var element = document.createElement("input");
    var element2 = document.createElement("input");
 
    //Assign different attributes to the element.
    element.setAttribute("type", "file");
    element.setAttribute("name", "file"+i);
    
    element2.setAttribute("type", "hidden");
    element2.setAttribute("name", "hidden"+i);
    element2.setAttribute("value", "ok");
 
    var foo = document.getElementById("fooBar");
    var br = document.createElement("br");
    
    if(i == 1)
    {
      var avert = document.createElement("p");
      var bold = document.createElement("b");
      var text = document.createTextNode("Taille totale autorisée : 10 Mo. Type de fichiers autorisés : zip, pdf, doc, gif, jpg, png, bmp.");
      bold.appendChild(text);
      avert.appendChild(bold);
      foo.appendChild(avert);
      foo.appendChild(br);
    }
    
    i = i+1;
 
    //Append the element in page (in span).
    foo.appendChild(element2);
    foo.appendChild(element);
    foo.appendChild(br);
}
</SCRIPT>

<h3>Poster un commentaire</h3>
<%= form_for :correction, url: problem_submission_corrections_path(@problem, @submission), :html => { :multipart => true } do |f| %>
  <div class="well" id="MathPreview"></div>
  <div class="well" id="MathBuffer" style="visibility:hidden; position:absolute; top:0; left: 0"></div>
  <% if @ancientexte.nil? %>
    <%= f.text_area :content, :class => "span12", :style => "height:200px; margin-top:5px;", :id=>"MathInput", :onkeyup => "Preview.Update()" %>
  <% else %>
    <%= f.text_area :content, :class => "span12", :value => @ancientexte, :style => "height:200px; margin-top:5px;", :id=>"MathInput", :onkeyup => "Preview.Update()" %>
  <% end %>
  <br />
  <span id="fooBar"></span>
  <br/>
  <input type="button" value="Ajouter une pièce jointe" onclick="add()"/>
  <br /><br/>
  <% if current_user.admin? %>
    <% case @submission.status %>
    <% when 1 ## Faux %>
      <%= f.submit "Poster", class: "btn btn-large btn-primary" %>
    <% when 3 ## Nouveau commentaire %>
      <%= f.submit "Poster et laisser la soumission comme erronée", class: "btn btn-large btn-danger" %>
    <% else ## Pas encore corrigé %>
      <%= f.submit "Poster et refuser la soumission", class: "btn btn-large btn-danger" %>
    <% end %>
    <%= f.submit "Poster et accepter la soumission", class: "btn btn-large btn-success", data: {confirm: "Etes-vous sûr de vouloir accepter cette soumission? Vous ne pourrez plus revenir en arrière."} %>
  <% else %>
    <%= f.submit "Poster", class: "btn btn-large btn-primary" %>
  <% end %>
<% end %>

<script>
Preview.Init();
Preview.Update();
</script>
