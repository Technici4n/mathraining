<SCRIPT language="javascript">
var i = 1;
function add() {

    //Create an input type dynamically.
    var element = document.createElement("input");
    var element2 = document.createElement("input");

    //Assign different attributes to the element.
    element.setAttribute("type", "file");
    element.setAttribute("name", "file"+i);

    element2.setAttribute("type", "hidden");
    element2.setAttribute("name", "hidden"+i);
    element2.setAttribute("value", "ok");

    var foo = document.getElementById("fooBar");
    var br = document.createElement("br");

    if(i == 1)
    {
      var avert = document.createElement("p");
      var bold = document.createElement("b");
      var text = document.createTextNode("Taille totale autorisée : 10 Mo. Type de fichiers autorisés : zip, pdf, doc, gif, jpg, png, bmp.");
      bold.appendChild(text);
      avert.appendChild(bold);
      foo.appendChild(avert);
      foo.appendChild(br);
    }

    i = i+1;

    //Append the element in page (in span).
    foo.appendChild(element2);
    foo.appendChild(element);
    foo.appendChild(br);
}
</SCRIPT>

<% r = 0 %>
<% if(params.has_key?:r) %>
  <% r = params[:r].to_i %>
<% end %>

<h4>Poster un commentaire</h4>
<%= form_for :correction, url: problem_submission_corrections_path(@problem, @submission, :r => r), :html => { :multipart => true } do |f| %>
  <div class="form-group">
  <div class="well" id="MathPreview"></div>
  <div class="well" id="MathBuffer" style="visibility:hidden; position:absolute; top:0; left: 0"></div>
  <a href="#ici" onClick="JavaScript: TAinsert('[b]','[/b]','MathInput'); PreviewSafe.Update();"><%= image_tag "bold.jpg", :title => "Gras", :style=>"margin-left:5px;" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert('[i]','[/i]','MathInput'); PreviewSafe.Update();"><%= image_tag "italics.jpg", :title => "Italique" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert('[u]','[/u]','MathInput'); PreviewSafe.Update();"><%= image_tag "underlined.jpg", :title => "Souligné" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert('[url=http://www.exemple.com]','[/url]','MathInput'); PreviewSafe.Update();"><%= image_tag "link.jpg", :title => "Lien", :style=>"margin-left:15px;" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :-)','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley1.gif", :title => ":-)", :style=>"margin-left:15px;" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :-(','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley2.gif", :title => ":-(" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' ;-)','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley7.gif", :title => ";-)" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :\'(','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley6.gif", :title => ":'(" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :-D','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley3.gif", :title => ":-D" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :-O','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley4.gif", :title => ":-O" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :-P','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley5.gif", :title => ":-P" %></a>
  <a href="#ici" onClick="JavaScript: TAinsert(' :-|','','MathInput'); PreviewSafe.Update();"><%= image_tag "Smiley8.gif", :title => ":-|" %></a>
  <% @ancientexte = session[:ancientexte] %>
  <% if @ancientexte.nil? %>
    <%= f.text_area :content, :class => "form-control", :style => "height:200px; margin-top:5px;", :id=>"MathInput", :onkeyup => "PreviewSafe.Update()", :disabled => current_user.other %>
  <% else %>
    <%= f.text_area :content, :class => "form-control", :value => @ancientexte, :style => "height:200px; margin-top:5px;", :id=>"MathInput", :onkeyup => "PreviewSafe.Update()", :disabled => current_user.other %>
  <% end %>
  <% session.delete(:ancientexte) %>
  </div>
  <span id="fooBar"></span>
  <input type="button" value="Ajouter une pièce jointe" onclick="add()"/>
  <input type="hidden" name="lastcomment" value="<%= @lastid %>">
  <br /><br/>
  <% if current_user.sk.admin? %>
    N'hésitez pas à faire des commentaires, même minimes, pouvant permettre à l'étudiant de progresser. On signalera par exemple une erreur de notation, un oubli de cas particulier, une suggestion d'amélioration... Si une grosse partie est manquante, alors on refusera la solution en demandant de la compléter.<br/><br/>
    <% case @submission.status %>
    <% when 1 ## Faux %>
      <%= f.submit "Poster", class: "btn btn-primary" %>
      <%= f.submit "Poster et accepter la soumission", class: "btn btn-success", data: {confirm: "Etes-vous sûr de vouloir accepter cette soumission? Vous ne pourrez plus revenir en arrière."} %>
    <% when 2 ## Correct %>
      <%= f.submit "Poster", class: "btn btn-primary" %>
    <% when 3 ## Nouveau commentaire %>
      <%= f.submit "Poster et laisser la soumission comme erronée", class: "btn btn-danger" %>
      <%= f.submit "Poster et accepter la soumission", class: "btn btn-success", data: {confirm: "Etes-vous sûr de vouloir accepter cette soumission? Vous ne pourrez plus revenir en arrière."} %>
    <% else ## Pas encore corrigé %>
      <%= f.submit "Poster et refuser la soumission", class: "btn btn-danger" %>
      <%= f.submit "Poster et accepter la soumission", class: "btn btn-success", data: {confirm: "Etes-vous sûr de vouloir accepter cette soumission? Vous ne pourrez plus revenir en arrière."} %>
    <% end %>
  <% else %>
    <%= f.submit "Poster", class: "btn btn-primary", :disabled => current_user.other %>
  <% end %>
<% end %>

<script>
PreviewSafe.Init();
PreviewSafe.Update();
</script>
